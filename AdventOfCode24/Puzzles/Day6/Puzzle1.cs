namespace AdventOfCode.Puzzles.Day6;

using NUnit.Framework;

public class Puzzle1
{
    [Test]
    public void Solve()
    {
        var grid = PuzzleInput.Split('\n', StringSplitOptions.RemoveEmptyEntries);
        var rows = grid.Length;
        var cols = grid[0].Length;

        bool ValidPosition(int x, int y) => x >= 0 && x < rows && y >= 0 && y < cols;

        var directions = new Dictionary<char, (int, int, char)>
        {
            { '^', (-1, 0, '>') },
            { '>', (0, 1, 'v') },
            { 'v', (1, 0, '<') },
            { '<', (0, -1, '^') }
        };
        var (currentDirection, x, y) = grid
            .SelectMany((row, x) => row.Select((cell, y) => (cell, x, y)))
            .First(t => t.cell == '^');
        var visited = new HashSet<(int, int)>();

        while (ValidPosition(x, y))
        {
            visited.Add((x, y));

            var (dx, dy, nextDirection) = directions[currentDirection];
            var nextX = x + dx;
            var nextY = y + dy;

            if (ValidPosition(nextX, nextY) && grid[nextX][nextY] is '#')
            {
                currentDirection = nextDirection;
            }
            else
            {
                x = nextX;
                y = nextY;
            }
        }

        Console.WriteLine($"Visited {visited.Count} distinct positions in the grid");
    }

    private const string PuzzleInput = """
        ...........#....................#......#.....................#.#...........#......................................................
        .....................................#....#.................#...............................#.....................................
        ..#..#.......#.............................................#.#.........................#......................#..............#....
        .........................#.....#...............#.................#................................................................
        .......#..........#........#.#............................................#....#.....................#..........##..#.............
        .........#.....................................................#..............................................................#...
        .....#..............................................................#................##.....#...........#.......#.........#.......
        .......#.........#......#...............#............................#.........#.....#.....#...#..................................
        .......#...............#...................#...............#............#.......................................................#.
        ........#.......................................................................##..#..............#...#..........................
        ..............#........#.......................#......#...............#..#......................#......#...#............#.........
        ................#................#...........................................#.....#................#..........#..................
        ..##....................#...........#......................#..................#.......#...........................................
        ..................................................................#..........#...................#................................
        ........................#.......#..........................#................................#.....................#...#.#.........
        ...............#........#...............#.##..#.#...............#...........#......................................#..............
        .#.........#.#...............................................................................#..........................#...#.....
        ..............................#.....#.............##..............#.##....................#......#.................#....#.........
        ..............#.............................#........#.....#..........................................#...........#...............
        ...................#.................#..............#....##..#......................#..............................#....#.#.......
        .............##.....................#..........#....................................#.....................#...#.#.................
        .........................#..........#.......#.................................#...................................................
        ............#.................#.................................................#.........##....................#.........#.....#.
        .#.........#.........................#..............#............#..#...........................##.........#......................
        ...........................#.....#...................#....#...........#.#.#...........#...................#.......................
        .................#..#......#..............................................................................#...................#...
        ...............................#..............#...#..#......##.#.........................#........#...........#...................
        ........#...............##.............................................................#..........................#...............
        .............#.............#.............#...................#...........#....................#...................................
        ##.......................................................................................#....#...........#....#...........#......
        .....................#.#.......................................#.....................................#.................#..........
        ......................#...................................................................#.....................#............#...#
        .........................#.#........................#.#................#....#....#.....#..........................................
        .....................#...#.......................................#.......#.............#...................#......................
        .............#...............#...............................................................................................#....
        ........................................................................................................#........#.........#......
        .................................##....................#....#..............#.....#.....#..#....#.........................#.#.....#
        .........................................................................#........#........#.........................#...#........
        #...................#..........#......................#..............................#.#........................#.................
        .#.....................................................................#..#.......#........................#......................
        .......................#..............#..............#..#..............................#..........................................
        ...................................................................................................#...................#..........
        ...............#............#....................................#.....................#....................#.....................
        ............#..#.#..........#.#.......#..........................#.................#.#..........#.......#.........................
        .......#....#.............................#..............................#..#........................#........#...................
        ........#.................#.....#.#..............................#........................#...................#..........#........
        ............................#........................#.........................................................#..................
        ....................................#.............##....................................................................#..#......
        ..................................................#................................................#..............#........#...##.
        ...........##.................#.........................#....................................................#...........#........
        ...........#.#..................#.......................#...#.......#................#.......##...................................
        ................................................#...........#........#.......................#.....................#....#.#.......
        ...............#........................................#............................#.....................................#......
        ........#...#.....#.......................................................#.#................................#.#..................
        .....#............#.#...............#.#.....#....................#.#...................#...................##.........#..........#
        ............#.................#....................................................#...........................................#..
        ................#..#.....#....................................#................#...#..............................................
        .....................................................................#...............#............................................
        ..................#...........#.....#...................#....#..............................................#.....................
        .#............#...................................#.........#.........................................#...........#...............
        #.......#..#...#.....#............................................................................................................
        ..#.........................................................##..............................#................................#....
        ..............................#..............#........................................................#....................#......
        #.........#.........#.............#..............#............................#..........#........................#..#............
        ....#...........#..........................##......#.............................#.....#........................#.................
        .....#.................................................................#..#.......................................................
        ..........................#.......#.......#..................#....................................................................
        ................#....................#..................#.........................................................................
        ..............................................#..........................#...........#.....#...........................#....#.#...
        .##...............#...#...........................................................................................................
        ..................#..#.......................#...#..#.#.................................#.........................#...........#...
        ..........................................................................#....................................#..................
        #...........#.............................##.....................#........#....#...#........#.....................#.....#.........
        .......#.............................#...^....#..................................#.........#......................................
        ........#..............................#................................#.....#....##.............................................
        .................#...........................#........................#..........#..........#.................#.#..........#.....#
        ..................................................................................................................#...............
        ..........#.........#........................#........................................................#........................#..
        ................................................................................................................#.................
        ....................#......................#....#.......#.....#...................................................................
        ................................#........................................................#.........................###............
        ......#..............#.#....................#............#.......................#.......................................#........
        .........................#....................................#..............#.......#............................................
        ..............#.................#........................................................#..#.....................................
        .....#.#........................#...........................................#..#.....#.................#................#......##.
        ................#.............#...................................................................................................
        #....................#..........#..............##...#........#..#.........................#............#......#..................#
        ...........#..#.......#.....................#..........................................................#........#.................
        ...............................................#................#...........#................................#....................
        .............#.......#.................#........#.............................................#...........#.......................
        ....................#.......#.....#.......................#.................#.............#.........................#.............
        .#..............#.................................................................................................................
        ..#.#......................................#.................#.........#...................................#.#....................
        ......#..............................#........#.#..................#................#.................................#...........
        ..............#........................................#..........................................................................
        .#...........#.........#...........#...................#................#..................................#............#..#......
        .........#....#...................#..#.................................................................#....#.....................
        ..........#...........................#.....................................#...............#.......#...#.........................
        ...........#..................................#............................................................##................#....
        .......................#..#.......................................................................................................
        ...............................................#......................#.#.#.............#..#........#...........................#.
        ..#.................................................#..............................#.....................................#........
        ..........#..#..........#...................#......................................##......#.......#........#.....#...............
        .#.#...............................................##...#................#..............#.....#...................................
        ....................#..#...............................#..#.......#....................#....#.....................#.....#.#.......
        #...................#...........#...................................................#...........................#..##.........###.
        .............#.........#......#..........................#.................#......##................#...............#...#.........
        ........#.....................................................................................#...................................
        ..#...........#...................................#...................#............................#.........#.................#..
        .................................................................................#................................................
        .#........#.................#......................................#.....#...........#................#...........................
        #...........................#..............................#....#............................................................#....
        #..........#.............................................#..........#.......................................................#.....
        .........#...#...#...#............................................................#....#..........#.......................#.......
        .........................#.........................#........#............#..............#.....##.........................#...#....
        ...............................#...........#..............................................#......................#......#.........
        ......................#........................#..#.....................#...............................#........................#
        ......#...##..............................................................................................................#.......
        ............#.............#.#...............................................#.........#..........................#...........#....
        .......................................#............#...............................................#.............................
        ....#........#.............................#...............#.#................................................#...................
        .........#.#........................#.....#...##...#.........###............#.#.........#......#.........#................#.....#.
        ...........#....................#......................##...............#.......................................................#.
        #......................................................#.................##....................................#........#.....#...
        ..#..........................##.................#...........................................#.....................................
        .......................................#............#......#...#.........#......##......................................#.........
        .#.......#.........................................##..............................................#.#...................#........
        .................#.........#..........................##............................#..#.....#....................................
        .....#....................................#......................................#.......................#...........#..#..#......
        .......#......#.........#.....#........#......#.................#...........#............#..................#....#...........#....
        """;
}
